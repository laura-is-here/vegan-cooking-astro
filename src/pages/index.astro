---
import { getCollection } from "astro:content";

import Layout from "../layouts/Layout.astro";
import Card from "../components/Card.astro";
import Tags from "../components/Tags.astro";
import Ingredients from "../components/Ingredients.astro";

const recipes = await getCollection("recipes");

const tags = [
  ...new Set(
    recipes
      .filter((recipe) => (recipe.data.tags ? recipe : false))
      .map((recipe) => recipe.data.tags)
      .flat()
  ),
];

const ingredients = [
  ...new Set(
    recipes
      .filter((recipe) => (recipe.data.ingredient ? recipe : false))
      .map((recipe) => recipe.data.ingredient)
      .flat()
  ),
];
---

<Layout title="Vegan Home Cooking by Tiff & Laura">
  <header class="">
    <div class="container flow">
      <h1>Vegan Homecooking by Tiff & Laura</h1>

      <p class="text-step-1">
        A personal reference and chronicle for our favorite vegan original and
        adapted vegan recipes.
      </p>
    </div>
  </header>

  <section class="with-sidebar">
    <div class="flow sidebar container">
      <h2>Browse by category</h2>
      <Tags tags={tags} />
      <h2>Browse by main ingredient</h2>
      <Ingredients ingredients={ingredients} />
    </div>
    <div class="not-sidebar flow">
      <h2 class="container" id="recipes">Recipes</h2>
      <ul role="list" class="flow">
        {
          recipes.map((recipe) => (
            <li class="card flow">
              <h3>
                <a href={`/recipes/${recipe.slug}`}>{recipe.data.title}</a>
              </h3>
              <p>
                <a class="uppercase" href={`/tags/${recipe.data.tags[0]}`}>
                  {recipe.data.tags[0]}
                </a>
              </p>
            </li>
          ))
        }
      </ul>
    </div>
  </section>
</Layout>
